!function () { "use strict"; var e, t, n = void 0 !== window.navigator.getGamepads; function a(e, t) { var n = []; return Object.keys(t).forEach(function (a) { t[a] === e ? n.push(a) : Array.isArray(t[a]) && -1 !== t[a].indexOf(e) && n.push(a) }), n } function s() { this._events = { gamepad: [], axes: [], keyboard: {} }, this._handlers = { gamepad: { connect: null, disconnect: null } }, this._keyMapping = { gamepad: { button_1: 0, button_2: 1, button_3: 2, button_4: 3, shoulder_top_left: 4, shoulder_top_right: 5, shoulder_bottom_left: 6, shoulder_bottom_right: 7, select: 8, start: 9, stick_button_left: 10, stick_button_right: 11, d_pad_up: 12, d_pad_down: 13, d_pad_left: 14, d_pad_right: 15, vendor: 16 }, axes: { stick_axis_left: [0, 2], stick_axis_right: [2, 4] }, keyboard: { button_1: 32, start: 27, d_pad_up: [38, 87], d_pad_down: [40, 83], d_pad_left: [37, 65], d_pad_right: [39, 68] } }, this._threshold = .3, this._listeners = [], this._handleKeyboardEventListener = this._handleKeyboardEventListener.bind(this), this.resume() } "undefined" !== String(typeof window) && ["webkit", "moz"].forEach(function (n) { e = e || window.requestAnimationFrame || window[n + "RequestAnimationFrame"] || null, t = t || window.cancelAnimationFrame || window[n + "CancelAnimationFrame"] || null }), s.prototype._handleGamepadConnected = function (e) { this._handlers.gamepad.connect && this._handlers.gamepad.connect({ index: e }) }, s.prototype._handleGamepadDisconnected = function (e) { this._handlers.gamepad.disconnect && this._handlers.gamepad.disconnect({ index: e }) }, s.prototype._handleGamepadEventListener = function (e) { var t = this; e && e.connected && e.buttons.forEach(function (n, s) { var o = a(s, t._keyMapping.gamepad); o && o.forEach(function (a) { n.pressed ? (t._events.gamepad[e.index][a] || (t._events.gamepad[e.index][a] = { pressed: !0, hold: !1, released: !1, player: e.index }), t._events.gamepad[e.index][a].value = n.value) : !n.pressed && t._events.gamepad[e.index][a] && (t._events.gamepad[e.index][a].released = !0, t._events.gamepad[e.index][a].hold = !1) }) }) }, s.prototype._handleGamepadAxisEventListener = function (e) { var t = this; e && e.connected && Object.keys(t._keyMapping.axes).forEach(function (n) { var a = Array.prototype.slice.apply(e.axes, t._keyMapping.axes[n]); Math.abs(a[0]) > t._threshold || Math.abs(a[1]) > t._threshold ? t._events.axes[e.index][n] = { pressed: !t._events.axes[e.index][n], hold: !!t._events.axes[e.index][n], released: !1, value: a } : t._events.axes[e.index][n] && (t._events.axes[e.index][n] = { pressed: !1, hold: !1, released: !0, value: a }) }) }, s.prototype._handleKeyboardEventListener = function (e) { var t = this, n = a(e.keyCode, t._keyMapping.keyboard); n && n.forEach(function (n) { "keydown" !== e.type || t._events.keyboard[n] ? "keyup" === e.type && t._events.keyboard[n] && (t._events.keyboard[n].released = !0, t._events.keyboard[n].hold = !1) : t._events.keyboard[n] = { pressed: !0, hold: !1, released: !1 } }) }, s.prototype._handleEvent = function (e, t, n) { t[e].pressed ? (this.trigger("press", e, t[e].value, n), t[e].pressed = !1, t[e].hold = !0) : t[e].hold ? this.trigger("hold", e, t[e].value, n) : t[e].released && (this.trigger("release", e, t[e].value, n), delete t[e]) }, s.prototype._loop = function () { var t, a = this, s = !!n && window.navigator.getGamepads(); if (s) { for (t = 0; t < 4; t += 1)s[t] ? (a._events.gamepad[t] || (a._handleGamepadConnected(t), a._events.gamepad[t] = {}, a._events.axes[t] = {}), a._handleGamepadEventListener(s[t]), a._handleGamepadAxisEventListener(s[t])) : a._events.gamepad[t] && (a._handleGamepadDisconnected(t), a._events.gamepad[t] = null, a._events.axes[t] = null); a._events.gamepad.forEach(function (e, t) { e && Object.keys(e).forEach(function (n) { a._handleEvent(n, e, t) }) }), a._events.axes.forEach(function (e, t) { e && Object.keys(e).forEach(function (n) { a._handleEvent(n, e, t) }) }) } Object.keys(a._events.keyboard).forEach(function (e) { a._handleEvent(e, a._events.keyboard, "keyboard") }), a._requestAnimation && (a._requestAnimation = e(a._loop.bind(a))) }, s.prototype.on = function (e, t, n, a) { var s = this; -1 !== Object.keys(this._handlers.gamepad).indexOf(e) && "function" == typeof t ? (this._handlers.gamepad[e] = t, this._events.gamepad = []) : ("string" == typeof e && e.match(/\s+/) && (e = e.split(/\s+/g)), "string" == typeof t && t.match(/\s+/) && (t = t.split(/\s+/g)), Array.isArray(e) ? e.forEach(function (e) { s.on(e, t, n, a) }) : Array.isArray(t) ? t.forEach(function (t) { s.on(e, t, n, a) }) : this._listeners.push({ type: e, button: t, callback: n, options: a })) }, s.prototype.off = function (e, t) { var n = this; "string" == typeof e && e.match(/\s+/) && (e = e.split(/\s+/g)), "string" == typeof t && t.match(/\s+/) && (t = t.split(/\s+/g)), Array.isArray(e) ? e.forEach(function (e) { n.off(e, t) }) : Array.isArray(t) ? t.forEach(function (t) { n.off(e, t) }) : this._listeners = this._listeners.filter(function (n) { return n.type !== e && n.button !== t }) }, s.prototype.setCustomMapping = function (e, t) { if (void 0 === this._keyMapping[e]) throw new Error('The device "' + e + '" is not supported through gamepad.js'); this._keyMapping[e] = t }, s.prototype.setGlobalThreshold = function (e) { this._threshold = parseFloat(e) }, s.prototype.trigger = function (e, t, n, a) { this._listeners && this._listeners.forEach(function (s) { s.type === e && s.button === t && s.callback({ type: s.type, button: s.button, value: n, player: a, event: s, timestamp: Date.now() }) }) }, s.prototype.pause = function () { t(this._requestAnimation), this._requestAnimation = null, document.removeEventListener("keydown", this._handleKeyboardEventListener), document.removeEventListener("keyup", this._handleKeyboardEventListener) }, s.prototype.resume = function () { this._requestAnimation = e(this._loop.bind(this)), document.addEventListener("keydown", this._handleKeyboardEventListener), document.addEventListener("keyup", this._handleKeyboardEventListener) }, s.prototype.destroy = function () { this.pause(), delete this._listeners }, "function" == typeof define && void 0 !== define.amd ? define([], function () { return s }) : "object" == typeof module && void 0 !== module.exports ? module.exports = s : window.Gamepad = s }();